<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SWM Driver App — Multi Ward</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css">
  <link rel="manifest" href="manifest.json">
  <script src="https://js.arcgis.com/4.29/"></script>
  <style>
    html, body { height:100%; width:100%; margin:0; padding:0; font-family: Arial, sans-serif; background:#f0f0f0; }
    #viewDiv { height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom)); width:100vw; position:absolute; top:env(safe-area-inset-top); left:0; right:0; bottom:env(safe-area-inset-bottom); }
    .floating-panel { position:absolute; top:env(safe-area-inset-top,10px); left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.95); padding:8px 12px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:10; display:flex; gap:8px; align-items:center; max-width:90vw; }
    .floating-panel select, .floating-panel input { padding:6px; font-size:14px; border:1px solid #ccc; border-radius:6px; min-width:130px; }
    #recenterBtn { position:absolute; top:80px; right:12px; z-index:12; padding:8px; border-radius:8px; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.15); border:none; cursor:pointer; }
    #statusBar { position:absolute; bottom: env(safe-area-inset-bottom,10px); left:50%; transform:translateX(-50%); background: rgba(0,0,0,0.7); color:white; padding:8px 12px; border-radius:12px; font-size:0.9rem; max-width:90vw; text-align:center; z-index:11; }
    .ok { background:green; } .warn { background:orange; } .alert { background:red; }
  </style>
</head>
<body>
  <div id="viewDiv"></div>

  <div class="floating-panel" aria-hidden="false">
    <label for="wardSelect">Ward</label>
    <select id="wardSelect" aria-label="Select ward">
      <option value="">-- Select Ward --</option>
      <option value="Ward22-A">Ward 22-A</option>
      <option value="Ward22-B">Ward 22-B</option>
      <option value="Ward42-A">Ward 42-A</option>
      <option value="Ward42-B">Ward 42-B</option>
    </select>

    <label for="vehicleNumber">Vehicle</label>
    <input id="vehicleNumber" placeholder="Vehicle #" readonly />

    <button id="refreshNow" title="Refresh">Refresh</button>
  </div>

  <button id="recenterBtn" title="Recenter">⤵</button>

  <div id="directionIndicator">➡️ Direction</div>
  <div id="statusBar" class="ok">Status: ready</div>

<script>
const REFRESH_MS = 15000; // 15s
require([ 
  "esri/Map", 
  "esri/views/MapView", 
  "esri/geometry/Point", 
  "esri/geometry/Polygon", 
  "esri/geometry/Polyline", 
  "esri/Graphic",
  "esri/geometry/geometryEngine" ], 
  function (Map, MapView, Point, Polygon, Polyline, Graphic, geometryEngine) {
  // --- CONFIG: set correct API URL / token here ---
  const API_URL = "https://dsclitsapi.karnatakasmartcity.in/ITMSCiscoPG/VehicleCurrentStatus?RequestToken=bEpNMWlqSkdWaVAxMGhqTmtJeDhOakFEbjBUUGM4akdHUnpwbGpjUG1XUT0kaXRtcyQxMC0xMS0yMDI1IDEwOjI3OjQy";
  const ROUTE_BUFFER_METERS = 25;

  const statusBar = document.getElementById("statusBar");
  const recenterBtn = document.getElementById("recenterBtn");
  const wardSelect = document.getElementById("wardSelect");
  const vehicleNumberInput = document.getElementById("vehicleNumber");
  const refreshNowBtn = document.getElementById("refreshNow");
  const directionIndicator = document.getElementById("directionIndicator");

  const wardToVehicle = {
    "Ward22-A": "KA-17-D-9394",
    "Ward22-B": "KA-17-D-5186",
    "Ward42-A": "KA-17-D-9388",
    "Ward42-B": "KA-17-D-9397"
  };

  function setStatus(text, level="ok") {
    statusBar.className = level;
    statusBar.textContent = "Status: " + text;
    console.log("[STATUS]", text);
  }

  // flexible helpers
  function getAny(obj, keys) {
    for (const k of keys) if (obj && obj[k] !== undefined && obj[k] !== null && obj[k] !== "") return obj[k];
    return undefined;
  }
  const normalizePlate = s => (s || "").toString().toUpperCase().replace(/[^A-Z0-9]/g, "");
  function parseLatLon(v) {
    if (!v) return null;
    let lat = getAny(v, ["latitude","Latitude","lat","Lat","LATITUDE","lattitude","LATTITUDE"]);
    let lon = getAny(v, ["longitude","Longitude","lon","Lon","LONGITUDE","lng","Lng","LONG"]);
    lat = parseFloat(lat); lon = parseFloat(lon);
    if (!Number.isFinite(lat) || !Number.isFinite(lon)) return null;
    if (Math.abs(lat) > 90 && Math.abs(lon) <= 90) { const t = lat; lat = lon; lon = t; }
    if (Math.abs(lat) <= 90 && Math.abs(lon) <= 180) return { lat, lon };
    return null;
  }

  // --- Map Initialization ---
  const map = new Map({ basemap: "streets-navigation-vector" });
  const view = new MapView({ container: "viewDiv", map, center: [75.9063, 14.4634], zoom: 14 });

  // ----- GEOMETRIES (using exact coordinates you pasted) -----

  // Ward polygon (exact as provided)
  const wardPolygon = new Polygon({
    rings: [[
      [75.906312929997796,14.463494624976988],
      [75.905324698276274,14.463450586975057],
      [75.903882580516722,14.463468088681395],
      [75.902601618569918,14.463473004375714],
      [75.902626595441063,14.464444040160402],
      [75.902654891709915,14.46537203169396],
      [75.902690052503999,14.465572729797714],
      [75.90404186843756,14.465616733625382],
      [75.904989430118178,14.465617875764394],
      [75.905493117913124,14.465695689604445],
      [75.906974742890156,14.465943957347804],
      [75.908865791423182,14.466143742639645],
      [75.909752029232834,14.465892203162696],
      [75.909572466096506,14.465200411369949],
      [75.909385555499057,14.464512234851782],
      [75.909217260867933,14.463874218920125],
      [75.909162297002467,14.463698644277088],
      [75.908211658741095,14.463645776731255],
      [75.907382864227884,14.463571232826212],
      [75.906312929997796,14.463494624976988]
    ]],
    spatialReference: { wkid: 4326 }
  });

  // ROUTE 1 (large list — kept exactly as in original paste for route1)
  const route1 = new Polyline({
    paths: [[
      [75.90283078201503,14.464255583628358],
      [75.903439924313091,14.464265102052877],
      [75.903953887761759,14.464265101153558],
      [75.904106173561104,14.464255582728981],
      [75.904248940935929,14.464265102052877],
      [75.904800976284093,14.464331725628711],
      [75.904943743658919,14.464331725628711],
      [75.905314939732762,14.464322209002773],
      [75.905914563606302,14.464303173053054],
      [75.906104920405824,14.464312689678934],
      [75.906637919804211,14.46435076247775],
      [75.907256579627528,14.464398351902446],
      [75.90777054307614,14.464436422902622],
      [75.908018006825614,14.464484012327375],
      [75.908332095949504,14.464541119277271],
      [75.908712809548604,14.464579190277448],
      [75.909141112572343,14.464636297227401],
      [75.909274362421968,14.46463629812672],
      [75.909414705224549,14.46461956624006],
      [75.909474237646009,14.464607743752424],
      [75.909417130696056,14.464426905377422],
      [75.909331469371864,14.464436422902622],
      [75.909122077521943,14.464398351003126],
      [75.908332096848824,14.464246066103101],
      [75.906656955753988,14.464103297828956],
      [75.906504669954586,14.464084262778556],
      [75.905857456656349,14.46404619087906],
      [75.9057432427565,14.46404619177838],
      [75.905333974783161,14.464112816253532],
      [75.902792711014854,14.464103297828956],
      [75.902783193489654,14.46373210265449],
      [75.902887888964983,14.46374162017969],
      [75.903506548788243,14.46374162017969],
      [75.903630280213292,14.46375113770489],
      [75.903792084437214,14.463779691179866],
      [75.903963405286959,14.463789209604386],
      [75.904629654534972,14.463789209604386],
      [75.905372046682658,14.46374162017969],
      [75.905543367532459,14.46375113770489],
      [75.905866975080869,14.463760656129409],
      [75.906552259379339,14.463798727129586],
      [75.906780688078356,14.463817763079362],
      [75.907437418901793,14.463874870029258],
      [75.908027524350814,14.463931976979211],
      [75.908503416799306,14.463979566403907],
      [75.908912684772645,14.464027155828603],
      [75.909036416197694,14.46403667335386],
      [75.909302916796207,14.464093781203076],
      [75.909179184471839,14.463684513229737],
      [75.90907448719787,14.463703549179513],
      [75.908351131899281,14.46364644222956],
      [75.907684882651267,14.463608371229384],
      [75.907113812252703,14.463551263380168],
      [75.906428527054914,14.463503673955415],
      [75.906190580830696,14.463494156430215],
      [75.905886011030645,14.463484638005696],
      [75.905533850906579,14.463456085430039],
      [75.905067475983287,14.463446567005519],
      [75.904953261184119,14.463446567005519],
      [75.904753386859397,14.463465602055919],
      [75.904610618585252,14.463475119581176],
      [75.904020512236912,14.463484638905015],
      [75.903573175062036,14.463494156430215],
      [75.903192459664353,14.463494156430215],
      [75.902783192590334,14.463522709905192]
    ]],
    spatialReference: { wkid: 4326 }
  });

  // ROUTE 2 (the second long list — exactly as pasted)
  const route2 = new Polyline({
    paths: [[
      [75.909512308646185,14.464845689976642],
      [75.909302916796207,14.464912315351114],
      [75.909169666946639,14.464940867926771],
      [75.908912684772645,14.464912315351114],
      [75.9087603989733,14.464883760976818],
      [75.908560523749202,14.464883761876138],
      [75.908427274798953,14.464864725926418],
      [75.908217882049655,14.464826654026922],
      [75.907713437025564,14.464740993602049],
      [75.907580186276618,14.464721957652273],
      [75.907380311951897,14.464693404177297],
      [75.907199472677576,14.464674368227577],
      [75.906866347603909,14.4646458147526],
      [75.906685508329588,14.46463629812672],
      [75.90643804458017,14.464626779702144],
      [75.906085884456047,14.464598226227224],
      [75.905914563606302,14.464598226227224],
      [75.905705170857004,14.464579190277448],
      [75.905590956957155,14.464569671852928],
      [75.904905672658742,14.464579191176767],
      [75.904620137909092,14.464579191176767],
      [75.904172798935576,14.464579191176767],
      [75.903744495012518,14.464579190277448],
      [75.903306673564202,14.464569672752248],
      [75.90281174696463,14.464579190277448],
      [75.90281174696463,14.464864725926418],
      [75.903268603463346,14.464874243451618],
      [75.904020512236912,14.464864725027098],
      [75.904391708310754,14.464864725926418],
      [75.904810493809293,14.464864725926418],
      [75.90513410045844,14.464864725926418],
      [75.905505296532283,14.464864725027098],
      [75.905771795332157,14.464864725027098],
      [75.906019260880214,14.464874244350938],
      [75.906285759680145,14.464893279401394],
      [75.906628401379692,14.464921831976994],
      [75.906961526453358,14.46495038635129],
      [75.907294650627705,14.464978939826267],
      [75.907637293226571,14.465026529250963],
      [75.90805607872511,14.465083636200916],
      [75.908427274798953,14.465121708100412],
      [75.908636666648931,14.465178815050308],
      [75.90866522102317,14.46536917095051],
      [75.908950756672141,14.465283511424957],
      [75.909312434321464,14.465188331676188],
      [75.909559898070881,14.465121708100412],
      [75.909588451545858,14.465131225625612],
      [75.909648931852757,14.465383227354096],
      [75.909702665445707,14.465607118074104],
      [75.90966459444553,14.46565470570016],
      [75.909188701997039,14.465778438024529],
      [75.90906496967267,14.465787957348425],
      [75.908903166348125,14.465797473974305],
      [75.908560524648578,14.465768921398649],
      [75.908417756374433,14.465759402974129],
      [75.90775150802574,14.465635670649704],
      [75.907618257276795,14.465616634699984],
      [75.907208990202776,14.465569046174608],
      [75.90675213370406,14.465530975174431],
      [75.90615250983052,14.465473868224478],
      [75.90584793823183,14.465435796324982],
      [75.905514814057483,14.465407242850006],
      [75.905372046682658,14.465388206900286],
      [75.904943743658919,14.465359654324629],
      [75.904582066009596,14.46534061837491],
      [75.904429780210251,14.46534061837491],
      [75.903877745761406,14.46534061837491],
      [75.903363780514098,14.465331099950333],
      [75.902964031864656,14.465331099950333],
      [75.902849818864127,14.46535013500079],
      [75.902811746065311,14.465093153726116],
      [75.903163906189377,14.465112189675835],
      [75.90354462068774,14.465112189675835],
      [75.903868226437567,14.465112189675835],
      [75.904277494410906,14.465112189675835],
      [75.904762904384597,14.465112189675835],
      [75.905505295632963,14.465140743150812],
      [75.905724206806781,14.465150260676012],
      [75.905990705606655,14.465159779100588],
      [75.906352385054561,14.465188333474885],
      [75.906571295329059,14.465207367625965],
      [75.906837795028252,14.465226404475061],
      [75.90706622282795,14.465245438626141],
      [75.90736127690144,14.465273993000437],
      [75.907532597751242,14.465293028950157],
      [75.907818132500893,14.46534061837491],
      [75.908027524350814,14.465378689375086],
      [75.908284506524808,14.465397725324806],
      [75.908531970274282,14.465416761274582],
      [75.90866522102317,14.465445313850182],
      [75.908722327973123,14.465550010224831],
      [75.908760399872619,14.465597599649527],
      [75.908903166348125,14.465569046174608],
      [75.909198219522295,14.465502420800135],
      [75.909540863020482,14.465407242850006],
      [75.909648931852757,14.465383227354096],
      [75.909712183870226,14.465369171849829],
      [75.909778808345379,14.465683260074456],
      [75.909807361820356,14.465883135298498]
    ]],
    spatialReference: { wkid: 4326 }
  });
  const wardPolygon1 = new Polygon({
    rings: [[
	[75.908278917238306,14.456524181246039],
		[75.908749786973146,14.456417116057082],
		[75.909092258700809,14.456499144120244],
		[75.908984811300058,14.455950723147396],
		[75.908923663696157,14.455400797608775],
		[75.909097424406696,14.454668172098536],
		[75.90929596413747,14.453992858583604],
		[75.909248823474456,14.453265870023927],
		[75.909210609482102,14.45231877958804],
		[75.90923778969227,14.451758945319114],
		[75.909078710414235,14.451271589212524],
		[75.908889419311322,14.450597772169488],
		[75.908725530458923,14.450134354217141],
		[75.908590923532358,14.449627767007883],
		[75.908447313492786,14.44932214320238],
		[75.908419557716456,14.449280949756087],
		[75.908106519900002,14.448816350094546],
		[75.907445567658897,14.448048669010916],
		[75.90704092130153,14.447533551732079],
		[75.906304788435307,14.44638343394837],
		[75.905697693893501,14.445577267277088],
		[75.905494891376179,14.445200107798769],
		[75.905419223318574,14.444698075655708],
		[75.905367597736529,14.44407156654961],
		[75.905091315212076,14.443732961906733],
		[75.904529149001064,14.443108412423328],
		[75.904037790911389,14.442755322400274],
		[75.903668308945385,14.442433815668096],
		[75.903305699598434,14.441990290719389],
		[75.902824318587477,14.441310409547839],
		[75.901857152585592,14.440682619807092],
		[75.901587379354112,14.440266734622128],
		[75.901009283451742,14.440517428736371],
		[75.899407471277812,14.441212054292919],
		[75.899555652571394,14.442474842739841],
		[75.899868064459667,14.44386580526276],
		[75.899899804232632,14.444128804800528],
		[75.89990884961378,14.444852357050706],
		[75.90157669450889,14.447785591232105],
		[75.902714101274796,14.449838369345343],
		[75.903633899984527,14.451490117275114],
		[75.904672424492844,14.453361469756089],
		[75.905206266556036,14.454258815092317],
		[75.905542112978196,14.454755062795982],
		[75.906489548753711,14.455947424434157],
		[75.907052241068129,14.456691565763208],
		[75.907170336441936,14.456758086816308],
		[75.908266631599815,14.45652677399147],
		[75.908278917238306,14.456524181246039]
	]],
    spatialReference: { wkid: 4326 }
  });
  const route1A = new Polyline({
    paths: [[
        [75.91322901400008,14.467565982000053],
[75.91323198300006,14.467187969000065],
[75.91349801200005,14.467174011000054],
[75.91568298900006,14.463846025000066],
[75.91579899400006,14.46345997900005],
[75.91648700000007,14.467416018000051],
[75.91686700500003,14.46734195700003],
[75.91464697500004,14.46784800000006],
[75.91523202800005,14.46770200800006],
[75.91815001000003,14.467250996000075],
[75.91907700900003,14.46719097600004],
[75.91256900300004,14.462864030000048],
[75.91267200200008,14.462663964000058],
[75.91289303200006,14.462272993000056],
[75.91298697800005,14.462048014000061],
[75.91304801800004,14.461671040000056],
[75.91661001900007,14.464971994000052],
[75.91652398700006,14.46529799600006],
[75.91681903300008,14.464170976000048],
[75.91695301800007,14.463654972000029],
[75.91704001000005,14.463321012000051],
[75.91712497700007,14.462997002000066],
[75.91719600000005,14.462724025000057],
[75.91472101300008,14.468870993000053],
[75.91137299100006,14.464903026000059],
[75.91130497400007,14.464657977000059],
[75.91144799200003,14.465172002000031],
[75.91151803100007,14.46542499700007],
[75.91158701100005,14.465680980000059],
[75.91166803400006,14.46598202000007],
[75.91175400600008,14.466295966000075],
[75.91184203700004,14.46662698700004],
[75.91191603000004,14.466930042000058],
[75.91228896900003,14.468273027000066],
[75.91686097600007,14.467271026000049],
[75.91691596700008,14.46689398500007],
[75.91704001500005,14.466435958000034],
[75.91653798900006,14.46287301600006],
[75.91660996900004,14.462572015000035],
[75.91464297700009,14.467787003000069],
[75.91462399000005,14.467521969000074],
[75.91459700800004,14.466930034000029],
[75.91610603700008,14.46244101600007],
[75.91633403000003,14.462499966000053],
[75.91557997500007,14.462305040000047],
[75.91506800300004,14.462171991000048],
[75.91455603200006,14.462039032000064],
[75.91632701800006,14.465977034000048],
[75.91643503000006,14.465638020000029],
[75.91529399200004,14.467626022000047],
[75.91521001900009,14.467129035000028],
[75.91574397100004,14.467526020000037],
[75.91564199900006,14.46704302300003],
[75.91623798700004,14.466597983000042],
[75.91615896800005,14.466302000000042],
[75.91490203400008,14.466256995000037],
[75.91512801200008,14.465281012000048],
[75.91405499600006,14.466039016000025],
[75.91426502900003,14.466026993000071],
[75.91753101500007,14.464533007000057],
[75.91825101900008,14.464723991000028],
[75.91840396400005,14.464094024000076],
[75.91878097700004,14.464335967000068],
[75.91892798400005,14.464402009000025],
[75.91904201800008,14.464431030000071],
[75.91947696200003,14.464528035000058],
[75.91975297700003,14.464562027000056],
[75.91625802700008,14.462790045000077],
[75.91605202200003,14.463522989000069],
[75.91408602300004,14.466648020000036],
[75.91429803400007,14.466633006000052],
[75.91387203200003,14.467956041000036],
[75.91379898200006,14.467341958000077],
[75.91353501600008,14.467373986000041],
[75.91307599500004,14.468107006000025],
[75.91309400700004,14.467591001000073],
[75.91320201200006,14.464141017000031],
[75.91319301100003,14.463772992000031],
[75.91320496400004,14.464283005000027],
[75.91227198600006,14.462856956000053],
[75.91262702200004,14.461578037000038],
[75.91787603500006,14.46318795600007],
[75.91997099600007,14.463721021000026],
[75.91415800500005,14.463465995000035],
[75.91425800700006,14.464778040000056],
[75.91421101100008,14.464623026000027],
[75.91417100900003,14.464456958000028],
[75.91416196400007,14.464377994000074],
[75.91415101200005,14.463551981000023],
[75.91440701300007,14.46531400300006],
[75.91437603000008,14.465164984000069],
[75.91455400400008,14.466012040000066],
[75.91454998800003,14.465927995000072],
[75.91452602500004,14.465792959000055],
[75.91444003300006,14.465475037000033],
[75.91455898300006,14.466107019000049],
[75.91704303500006,14.465811005000035],
[75.91488100900006,14.46521400000006],
[75.91510102000007,14.464910978000034],
[75.91091696900008,14.463144033000049],
[75.91091297200006,14.462838989000034],
[75.91097002400005,14.46341598600003],
[75.91103497600005,14.463659963000055],
[75.91109999200006,14.463900957000021],
[75.91116602000005,14.46414601500004],
[75.91123198300005,14.464393965000056],
[75.91536400700005,14.46462198000006],
[75.91596997100004,14.463942979000024],
[75.91757501100005,14.464347993000047],
[75.91794600300005,14.462918960000025],
[75.91719200900008,14.46585299700007],
[75.91740596400007,14.465062987000067],
[75.91715403500007,14.466014035000057],
[75.91642900000005,14.46315997000005],
[75.91632197500007,14.463441041000067],
[75.91603703600003,14.463861007000048],
[75.91627400200008,14.463532971000063],
[75.91544298600007,14.46453499100005],
[75.91566501500006,14.46431403300005],
[75.91458201600005,14.46661301100005],
[75.91456897100005,14.466323007000028],
[75.91498102400004,14.46506998500007],
[75.91459003600005,14.466048960000023],
[75.91461502800007,14.465967965000061],
[75.91467601800008,14.465653992000057],
[75.91473798400006,14.465484997000033],
[75.91480300300003,14.465332983000053],
[75.91519501400006,14.46368902000006],
[75.91469599800007,14.463582042000041],
[75.91372700200003,14.461843036000062],
[75.91415101100006,14.461942986000054],
[75.91328798500007,14.461739980000061],
[75.91672698500008,14.466499003000024],
[75.91574302600003,14.466697981000038],
[75.91485599500004,14.466877958000055],
[75.91661096300004,14.46591103000003],
[75.91385903500003,14.466049991000034],
[75.91366398700006,14.466059968000025],
[75.91346603800008,14.466071041000077],
[75.91402196700005,14.465370997000036],
[75.91422802100004,14.465340007000066],
[75.91382799300004,14.465400042000056],
[75.91363302400003,14.465429000000029],
[75.91342001300006,14.46546101000007],
[75.91388800800007,14.466661986000076],
[75.91369297700004,14.46667603000003],
[75.91351997800007,14.467251026000042],
[75.91355200500004,14.46750597700003],
[75.91361396500008,14.468009016000053],
[75.91359203100006,14.46765902900006],
[75.91324801900004,14.465009015000021],
[75.91321398300005,14.464824032000024],
[75.91328301300007,14.465204027000027],
[75.91259501700006,14.463558019000061],
[75.91258598400003,14.463388034000047],
[75.91255799100003,14.463296037000077],
[75.91251197100007,14.463229961000025],
[75.91261198700005,14.46387304500007],
[75.91262998100007,14.464214009000045],
[75.91263800200005,14.464361040000028],
[75.91318298000004,14.463339983000026],
[75.91318696700006,14.46349200000003],
[75.91144702900004,14.464391957000032],
[75.91188501900007,14.464410960000066],
[75.91230601000007,14.464388991000021],
[75.91284997700006,14.463831990000074],
[75.91290196400007,14.464178969000045],
[75.91672800700007,14.468762039000069],
[75.91990798600006,14.467817009000044],
[75.91983402200003,14.467152044000045],
[75.91568598700007,14.466388986000027],
[75.91666198900003,14.466190039000026],
[75.91491497400006,14.467193996000049],
[75.91512003800005,14.468845037000051],
[75.91542799400008,14.468831004000037],
[75.91170997700004,14.462817013000063],
[75.91205400200005,14.462851022000052],
[75.91137501000003,14.462733978000074],
[75.91097996600007,14.462607969000032],
[75.91111696800004,14.462679026000046],
[75.91616300800007,14.46883600700005],
[75.91656901200008,14.468832980000059],
[75.91663402500006,14.46881004000005],
[75.92007502800004,14.467137001000026],
[75.92113000000006,14.467053966000037],
[75.92021102000007,14.467816005000032],
[75.91675697000005,14.468922003000046],
[75.91673101100008,14.467294039000024],
[75.91649099300008,14.46734495800007],
[75.91907500100007,14.467111985000031],
[75.91816402900008,14.46718098100007],
[75.91272702000003,14.464353011000071],
[75.92081397400005,14.467745042000047],
[75.92115697400004,14.467676994000044],
[75.92026500400004,14.468106029000069],
[75.91412200900004,14.467907978000028],
[75.91134296200005,14.468513961000042],
[75.91229097100006,14.468351024000071],
[75.91310503500006,14.468173961000048],
[75.91413002300004,14.467977998000038],
[75.91581999700009,14.467576974000053],
[75.91474502300008,14.469390992000058],
[75.91453200400008,14.465291011000033],
[75.91405801300004,14.467318988000045],
[75.91345702400008,14.467029007000065],
[75.91360602100008,14.466851991000055],
[75.91364298800005,14.466762002000053],
[75.91349496200007,14.466689995000024],
[75.91631399200008,14.466905006000047],
[75.91093399400006,14.462665996000055],
[75.91937502900004,14.46796100000006],
[75.91920101200003,14.467187960000047]
          ]],
    spatialReference: { wkid: 4326 }
  });
  const route2B = new Polyline({
    paths: [[	
             [
              75.91304801800004,
              14.461671040000056
            ],
            [
              75.912627022000038,
              14.461578037000038
			],
            [
              75.912271986000064,
              14.462856956000053
            ],
            [
              75.91304801800004,
              14.461671040000056
            ],
            [
              75.913287985000068,
              14.461739980000061
            ],
            [
              75.91372700200003,
              14.461843036000062
            ],
            [
              75.914151011000058,
              14.461942986000054
            ],
            [
              75.914556032000064,
              14.462039032000064
            ],
            [
              75.914556032000064,
              14.462039032000064
            ],
            [
              75.915068003000044,
              14.462171991000048
            ],
         
            [
              75.915068003000044,
              14.462171991000048
            ],
            [
              75.915579975000071,
              14.462305040000047
             
			 ],
          
            [
              75.915579975000071,
              14.462305040000047
            ],
            [
              75.916106037000077,
              14.462441016000071
             
			],
            [
              75.916106037000077,
              14.462441016000071
            ],
            [
              75.91633403000003,
              14.462499966000053
			],
            [
              75.91633403000003,
              14.462499966000053
            ],
            [
              75.916609969000035,
              14.462572015000035
             
			],
            [
              75.916609969000035,
              14.462572015000035
            ],
            [
              75.917196000000047,
              14.462724025000057
			],
            [
              75.917196000000047,
              14.462724025000057
            ],
            [
              75.917946003000054,
              14.462918960000025
            ],
            [
              75.917876035000063,
              14.46318795600007 
			],
            [
              75.917196000000047,
              14.462724025000057
            ],
            [
              75.917124977000071,
              14.462997002000066
			],
            [
              75.916258027000083,
              14.462790045000077
            ],
            [
              75.91633403000003,
              14.462499966000053
			],
            [
              75.916258027000083,
              14.462790045000077
            ],
            [
              75.916537989000062,
              14.46287301600006
			],
            [
              75.916258027000083,
              14.462790045000077
            ],
            [
              75.916052022000031,
              14.463522989000069
            ],
            [
              75.915798994000056,
              14.463459979000049
			],
            [
              75.912271986000064,
              14.462856956000053
            ],
            [
              75.912569003000044,
              14.462864030000048
			],
            [
              75.912569003000044,
              14.462864030000048
            ],
            [
              75.912672002000079,
              14.462663964000058
            ],
            [
              75.912893032000056,
              14.462272993000056
            ],
            [
              75.912986978000049,
              14.462048014000061
            ],
            [
              75.91304801800004,
              14.461671040000056
			],
            [
              75.916537989000062,
              14.46287301600006
            ],
            [
              75.916609969000035,
              14.462572015000035
			],
            [
              75.916537989000062,
              14.46287301600006
            ],
            [
              75.917124977000071,
              14.462997002000066
			],
            [
              75.917124977000071,
              14.462997002000066
            ],
            [
              75.917040010000051,
              14.463321012000051
			],
            [
              75.916429000000051,
              14.463159970000049
            ],
            [
              75.916537989000062,
              14.46287301600006
			],
            [
              75.916429000000051,
              14.463159970000049
            ],
            [
              75.917040010000051,
              14.463321012000051
			],
            [
              75.917876035000063,
              14.46318795600007
            ],
            [
              75.917124977000071,
              14.462997002000066
			],
            [
              75.917040010000051,
              14.463321012000051
			 ],
            [
              75.916953018000072,
              14.463654972000029
			],
            [
              75.916321975000074,
              14.463441041000067
            ],
            [
              75.916429000000051,
              14.463159970000049
			],
            [
              75.916321975000074,
              14.463441041000067
            ],
            [
              75.916953018000072,
              14.463654972000029
			],
            [
              75.915798994000056,
              14.463459979000049
            ],
            [
              75.916106037000077,
              14.462441016000071
			],
            [
              75.914158005000047,
              14.463465995000035
            ],
            [
              75.914556032000064,
              14.462039032000064
			],
            [
              75.914158005000047,
              14.463465995000035
            ],
            [
              75.913182980000045,
              14.463339983000026
            ],
            [
              75.913186967000058,
              14.463492000000031
			],
            [
              75.914158005000047,
              14.463465995000035
            ],
            [
              75.91469599800007,
              14.463582042000041
			],
            [
              75.912595017000058,
              14.463558019000061
            ],
            [
              75.912585984000032,
              14.463388034000047
            ],
            [
              75.912557991000028,
              14.463296037000077
            ],
            [
              75.912511971000072,
              14.463229961000025
            ],
            [
              75.912569003000044,
              14.462864030000048
			],
            [
              75.912595017000058,
              14.463558019000061
            ],
            [
              75.913186967000058,
              14.463492000000031
			],
            [
              75.91469599800007,
              14.463582042000041
            ],
            [
              75.915068003000044,
              14.462171991000048
			],
            [
              75.91469599800007,
              14.463582042000041
            ],
            [
              75.915195014000062,
              14.463689020000061
			],
            [
              75.916953018000072,
              14.463654972000029
            ],
            [
              75.916819033000081,
              14.464170976000048
			],
            [
              75.915195014000062,
              14.463689020000061
            ],
            [
              75.915579975000071,
              14.462305040000047
			],
            [
              75.915195014000062,
              14.463689020000061
            ],
            [
              75.915682989000061,
              14.463846025000066
			],
            [
              75.919970996000075,
              14.463721021000026
            ],
            [
              75.917876035000063,
              14.46318795600007
			],
			[
              75.913193011000033,
              14.463772992000031
            ],
            [
              75.913186967000058,
              14.463492000000031
			],
            [
              75.912849977000064,
              14.463831990000074
            ],
            [
              75.913193011000033,
              14.463772992000031
			],
            [
              75.915682989000061,
              14.463846025000066
            ],
            [
              75.915798994000056,
              14.463459979000049
			],
            [
              75.915682989000061,
              14.463846025000066
            ],
            [
              75.915969971000038,
              14.463942979000024
			],
            [
              75.912611987000048,
              14.463873045000071
            ],
            [
              75.912595017000058,
              14.463558019000061
			],
            [
              75.912611987000048,
              14.463873045000071
            ],
            [
              75.912849977000064,
              14.463831990000074
			],
            [
              75.915969971000038,
              14.463942979000024
            ],
            [
              75.916037036000034,
              14.463861007000048
            ],
            [
              75.91627400200008,
              14.463532971000063
            ],
            [
              75.916321975000074,
              14.463441041000067
			],
            [
              75.915969971000038,
              14.463942979000024
            ],
            [
              75.916819033000081,
              14.464170976000048
			],
            [
              75.913202012000056,
              14.464141017000031
            ],
            [
              75.913193011000033,
              14.463772992000031
			],
            [
              75.916819033000081,
              14.464170976000048
            ],
            [
              75.917575011000054,
              14.464347993000047
			],
			[
              75.916819033000081,
              14.464170976000048
            ],
            [
              75.916610019000075,
              14.464971994000052
			],
            [
              75.912901964000071,
              14.464178969000045
            ],
            [
              75.912849977000064,
              14.463831990000074
			],
            [
              75.912901964000071,
              14.464178969000045
            ],
            [
              75.913202012000056,
              14.464141017000031
			],
            [
              75.912629981000066,
              14.464214009000045
            ],
            [
              75.912611987000048,
              14.463873045000071
			],
            [
              75.912629981000066,
              14.464214009000045
            ],
            [
              75.912901964000071,
              14.464178969000045
			],
            [
              75.913204964000045,
              14.464283005000027
            ],
            [
              75.913202012000056,
              14.464141017000031
			],
            [
              75.917575011000054,
              14.464347993000047
            ],
            [
              75.917876035000063,
              14.46318795600007
			],
            [
              75.912638002000051,
              14.464361040000028
            ],
            [
              75.912629981000066,
              14.464214009000045
			],
            [
              75.912638002000051,
              14.464361040000028
            ],
            [
              75.912727020000034,
              14.464353011000071
            ],
            [
              75.913204964000045,
              14.464283005000027
			],
            [
              75.91123198300005,
              14.464393965000056
            ],
            [
              75.911166020000053,
              14.46414601500004
            ],
            [
              75.911099992000061,
              14.463900957000021
            ],
            [
              75.911034976000053,
              14.463659963000055
            ],
            [
              75.910970024000051,
              14.46341598600003
            ],
            [
              75.910916969000084,
              14.463144033000049
            ],
            [
              75.910912972000062,
              14.462838989000034
            ],
            [
              75.910933994000061,
              14.462665996000055
            ],
            [
              75.91097996600007,
              14.462607969000032
            ],
            [
              75.911116968000044,
              14.462679026000046
            ],
            [
              75.911375010000029,
              14.462733978000074
            ],
            [
              75.911709977000044,
              14.462817013000063
            ],
            [
              75.912054002000048,
              14.462851022000052
            ],
            [
              75.912271986000064,
              14.462856956000053
			],
            [
              75.91123198300005,
              14.464393965000056
            ],
            [
              75.911447029000044,
              14.464391957000032
            ],
            [
              75.911885019000067,
              14.464410960000066
            ],
            [
              75.912306010000066,
              14.464388991000021
            ],
            [
              75.912638002000051,
              14.464361040000028
			],
            [
              75.917531015000066,
              14.464533007000057
            ],
            [
              75.917575011000054,
              14.464347993000047
			],
            [
              75.917531015000066,
              14.464533007000057
            ],
            [
              75.918251019000081,
              14.464723991000028
            ],
            [
              75.918403964000049,
              14.464094024000076
            ],
            [
              75.91878097700004,
              14.464335967000068
            ],
            [
              75.918927984000049,
              14.464402009000025
            ],
            [
              75.919042018000084,
              14.464431030000071
            ],
            [
              75.919476962000033,
              14.464528035000058
            ],
            [
              75.91975297700003,
              14.464562027000056
			],
            [
              75.915364007000051,
              14.464621980000061
            ],
            [
              75.915442986000073,
              14.46453499100005
            ],
            [
              75.915665015000059,
              14.464314033000051
            ],
            [
              75.915969971000038,
              14.463942979000024
			],
            [
              75.915364007000051,
              14.464621980000061
            ],
            [
              75.916610019000075,
              14.464971994000052
			],
            [
              75.914258007000058,
              14.464778040000056
            ],
            [
              75.914211011000077,
              14.464623026000027
            ],
            [
              75.914171009000029,
              14.464456958000028
            ],
            [
              75.914161964000073,
              14.464377994000074
            ],
            [
              75.914151012000048,
              14.463551981000023
            ],
            [
              75.914158005000047,
              14.463465995000035
			],
            [
              75.915101020000066,
              14.464910978000034
            ],
            [
              75.915364007000051,
              14.464621980000061
			],
            [
              75.915101020000066,
              14.464910978000034
            ],
            [
              75.916523987000062,
              14.465297996000061
			],
            [
              75.916610019000075,
              14.464971994000052
            ],
            [
              75.916523987000062,
              14.465297996000061
			],
            [
              75.913248019000036,
              14.465009015000021
            ],
            [
              75.913213983000048,
              14.464824032000024
            ],
            [
              75.913204964000045,
              14.464283005000027
			],
            [
              75.913248019000036,
              14.465009015000021
            ],
            [
              75.914258007000058,
              14.464778040000056
			],
            [
              75.914881009000055,
              14.46521400000006
            ],
            [
              75.914981024000042,
              14.465069985000071
            ],
            [
              75.915101020000066,
              14.464910978000034
			],
            [
              75.914881009000055,
              14.46521400000006
            ],
            [
              75.915128012000082,
              14.465281012000048
			],
            [
              75.915128012000082,
              14.465281012000048
            ],
            [
              75.916435030000059,
              14.465638020000029
			],
            [
              75.916523987000062,
              14.465297996000061
            ],
            [
              75.916435030000059,
              14.465638020000029
			],
            [
              75.914407013000073,
              14.46531400300006
            ],
            [
              75.914376030000085,
              14.465164984000069
            ],
            [
              75.914258007000058,
              14.464778040000056
			],
            [
              75.914407013000073,
              14.46531400300006
            ],
            [
              75.91453200400008,
              14.465291011000033
            ],
            [
              75.914881009000055,
              14.46521400000006
			],
            [
              75.914228021000042,
              14.465340007000066
            ],
            [
              75.914407013000073,
              14.46531400300006
			],
            [
              75.914021967000053,
              14.465370997000036
            ],
            [
              75.914228021000042,
              14.465340007000066
			],
            [
              75.913827993000041,
              14.465400042000056
            ],
            [
              75.914021967000053,
              14.465370997000036
			],
            [
              75.913633024000035,
              14.465429000000029
            ],
            [
              75.913827993000041,
              14.465400042000056
			],
            [
              75.913420013000064,
              14.46546101000007
            ],
            [
              75.913283013000068,
              14.465204027000027
            ],
            [
              75.913248019000036,
              14.465009015000021
			],
            [
              75.913420013000064,
              14.46546101000007
            ],
            [
              75.913633024000035,
              14.465429000000029
			],
            [
              75.913420013000064,
              14.46546101000007
            ],
            [
              75.913466038000081,
              14.466071041000077
			],
            [
              75.916435030000059,
              14.465638020000029
            ],
            [
              75.917043035000063,
              14.465811005000035
			],
            [
              75.917043035000063,
              14.465811005000035
            ],
            [
              75.917192009000075,
              14.46585299700007
			],
            [
              75.917192009000075,
              14.46585299700007
            ],
            [
              75.917405964000068,
              14.465062987000067
            ],
            [
              75.917531015000066,
              14.464533007000057
			],
            [
              75.916610963000039,
              14.465911030000029
            ],
            [
              75.917043035000063,
              14.465811005000035
			],
            [
              75.916327018000061,
              14.465977034000048
            ],
            [
              75.916435030000059,
              14.465638020000029
			],
            [
              75.916327018000061,
              14.465977034000048
            ],
            [
              75.916610963000039,
              14.465911030000029
			],
            [
              75.914554004000081,
              14.466012040000066
            ],
            [
              75.914549988000033,
              14.465927995000072
            ],
            [
              75.914526025000043,
              14.465792959000055
            ],
            [
              75.914440033000062,
              14.465475037000033
            ],
            [
              75.914407013000073,
              14.46531400300006
			],
            [
              75.914265029000035,
              14.466026993000071
            ],
            [
              75.914228021000042,
              14.465340007000066
			],
            [
              75.914265029000035,
              14.466026993000071
            ],
            [
              75.914554004000081,
              14.466012040000066
			],
            [
              75.914054996000061,
              14.466039016000025
            ],
            [
              75.914021967000053,
              14.465370997000036
			],
            [
              75.914054996000061,
              14.466039016000025
            ],
            [
              75.914265029000035,
              14.466026993000071
			],
            [
              75.91385903500003,
              14.466049991000034
            ],
            [
              75.913827993000041,
              14.465400042000056
			],
            [
              75.91385903500003,
              14.466049991000034
            ],
            [
              75.914054996000061,
              14.466039016000025
			],
            [
              75.913663987000064,
              14.466059968000025
            ],
            [
              75.913633024000035,
              14.465429000000029
			],
            [
              75.913663987000064,
              14.466059968000025
            ],
            [
              75.91385903500003,
              14.466049991000034
			],
            [
              75.913466038000081,
              14.466071041000077
            ],
            [
              75.913663987000064,
              14.466059968000025
			],
            [
              75.913466038000081,
              14.466071041000077
            ],
            [
              75.913494962000073,
              14.466689995000024
            ],
            [
              75.913692977000039,
              14.466676030000031
			],
            [
              75.914558983000063,
              14.466107019000049
            ],
            [
              75.914554004000081,
              14.466012040000066
			],
            [
              75.914558983000063,
              14.466107019000049
            ],
            [
              75.91459003600005,
              14.466048960000023
            ],
            [
              75.914615028000071,
              14.465967965000061
            ],
            [
              75.91467601800008,
              14.465653992000057
            ],
            [
              75.914737984000055,
              14.465484997000033
            ],
            [
              75.914803003000031,
              14.465332983000053
            ],
            [
              75.914881009000055,
              14.46521400000006
			],
            [
              75.916661989000033,
              14.466190039000026
            ],
            [
              75.916610963000039,
              14.465911030000029
			],
            [
              75.914902034000079,
              14.466256995000037
            ],
            [
              75.915128012000082,
              14.465281012000048
			],
            [
              75.914902034000079,
              14.466256995000037
            ],
            [
              75.916327018000061,
              14.465977034000048
			],
            [
              75.916158968000047,
              14.466302000000042
            ],
            [
              75.916661989000033,
              14.466190039000026
			],
            [
              75.914568971000051,
              14.466323007000028
            ],
            [
              75.914558983000063,
              14.466107019000049
			],
            [
              75.914568971000051,
              14.466323007000028
            ],
            [
              75.914902034000079,
              14.466256995000037
			],
            [
              75.917040015000055,
              14.466435958000034
            ],
            [
              75.917154035000067,
              14.466014035000057
            ],
            [
              75.917192009000075,
              14.46585299700007
			],
            [
              75.916726985000082,
              14.466499003000024
            ],
            [
              75.916661989000033,
              14.466190039000026
			],
            [
              75.916726985000082,
              14.466499003000024
            ],
            [
              75.917040015000055,
              14.466435958000034
			],
            [
              75.916237987000045,
              14.466597983000042
            ],
            [
              75.916158968000047,
              14.466302000000042
			],
            [
              75.916237987000045,
              14.466597983000042
            ],
            [
              75.916726985000082,
              14.466499003000024
			],
            [
              75.914582016000054,
              14.466613011000049
            ],
            [
              75.914568971000051,
              14.466323007000028
			],
            [
              75.914298034000069,
              14.466633006000052
            ],
            [
              75.914265029000035,
              14.466026993000071
			],
            [
              75.914298034000069,
              14.466633006000052
            ],
            [
              75.914582016000054,
              14.466613011000049
			],
            [
              75.914086023000038,
              14.466648020000036
            ],
            [
              75.914054996000061,
              14.466039016000025
			],
            [
              75.914086023000038,
              14.466648020000036
            ],
            [
              75.914298034000069,
              14.466633006000052
			],
            [
              75.913888008000072,
              14.466661986000076
            ],
            [
              75.91385903500003,
              14.466049991000034
			],
            [
              75.913888008000072,
              14.466661986000076
            ],
            [
              75.914086023000038,
              14.466648020000036
			],
            [
              75.913692977000039,
              14.466676030000031
            ],
            [
              75.913663987000064,
              14.466059968000025
			],
            [
              75.913692977000039,
              14.466676030000031
            ],
            [
              75.913888008000072,
              14.466661986000076
			],
            [
              75.91574302600003,
              14.466697981000038
            ],
            [
              75.915685987000074,
              14.466388986000027
            ],
            [
              75.916158968000047,
              14.466302000000042
	         ],
            [
              75.91574302600003,
              14.466697981000038
            ],
            [
              75.916237987000045,
              14.466597983000042
			],
            [
              75.914855995000039,
              14.466877958000055
            ],
            [
              75.91574302600003,
              14.466697981000038
			],
            [
              75.914855995000039,
              14.466877958000055
            ],
            [
              75.914914974000055,
              14.467193996000049
            ],
            [
              75.915210019000085,
              14.467129035000028
			],
            [
              75.914597008000044,
              14.466930034000029
            ],
            [
              75.914582016000054,
              14.466613011000049
			],
            [
              75.914597008000044,
              14.466930034000029
            ],
            [
              75.914855995000039,
              14.466877958000055
			],
            [
              75.915641999000059,
              14.467043023000031
            ],
            [
              75.916313992000084,
              14.466905006000047
            ],
            [
              75.916237987000045,
              14.466597983000042
			],
            [
              75.919075001000067,
              14.467111985000031
            ],
            [
              75.918164029000081,
              14.46718098100007
            ],
            [
              75.916860976000066,
              14.467271026000049
			],
            [
              75.915210019000085,
              14.467129035000028
            ],
            [
              75.915641999000059,
              14.467043023000031
	         ],
            [
              75.920075028000042,
              14.467137001000026
            ],
            [
              75.921130000000062,
              14.467053966000037
			],
            [
              75.920075028000042,
              14.467137001000026
            ],
            [
              75.920211020000067,
              14.467816005000032
			],
            [
              75.919834022000032,
              14.467152044000045
            ],
            [
              75.920075028000042,
              14.467137001000026
			],
			[
              75.919834022000032,
              14.467152044000045
            ],
            [
              75.919907986000055,
              14.467817009000044
            ],
            [
              75.919375029000037,
              14.467961000000059
            ],
            [
              75.91920101200003,
              14.467187960000047
			],
            [
              75.913498012000048,
              14.467174011000054
            ],
            [
              75.913457024000081,
              14.467029007000065
            ],
            [
              75.913606021000078,
              14.466851991000055
            ],
            [
              75.913642988000049,
              14.466762002000053
            ],
            [
              75.913692977000039,
              14.466676030000031
			],
            [
              75.91920101200003,
              14.467187960000047
            ],
            [
              75.919834022000032,
              14.467152044000045
			],
            [
              75.916860976000066,
              14.467271026000049
            ],
            [
              75.916915967000079,
              14.46689398500007
            ],
            [
              75.917040015000055,
              14.466435958000034
			],
            [
              75.916860976000066,
              14.467271026000049
            ],
            [
              75.916867005000029,
              14.467341957000031
			],
            [
              75.916860976000066,
              14.467271026000049
            ],
            [
              75.916731011000081,
              14.467294039000024
            ],
            [
              75.916490993000082,
              14.467344958000069
            ],
            [
              75.91574397100004,
              14.467526020000037
			],
            [
              75.916867005000029,
              14.467341957000031
            ],
            [
              75.918150010000033,
              14.467250996000075
            ],
            [
              75.919077009000034,
              14.46719097600004
            ],
            [
              75.91920101200003,
              14.467187960000047
			],
            [
              75.91379898200006,
              14.467341958000077
            ],
            [
              75.914058013000044,
              14.467318988000045
            ],
            [
              75.914122009000039,
              14.467907978000028
			],
            [
              75.913535016000083,
              14.467373986000041
            ],
            [
              75.913519978000068,
              14.467251026000042
            ],
            [
              75.913498012000048,
              14.467174011000054
			],
            [
              75.913535016000083,
              14.467373986000041
            ],
            [
              75.91379898200006,
              14.467341958000077
			],
            [
              75.916487000000075,
              14.467416018000051
            ],
            [
              75.916867005000029,
              14.467341957000031
			],
            [
              75.916487000000075,
              14.467416018000051
            ],
            [
              75.916728007000074,
              14.468762039000069
			],
            [
              75.913552005000042,
              14.46750597700003
            ],
            [
              75.913535016000083,
              14.467373986000041
			],
            [
              75.91574397100004,
              14.467526020000037
            ],
            [
              75.915641999000059,
              14.467043023000031
			],
            [
              75.91574397100004,
              14.467526020000037
            ],
            [
              75.915293992000045,
              14.467626022000047
			],
            [
              75.91322901400008,
              14.467565982000053
            ],
            [
              75.91323198300006,
              14.467187969000065
            ],
            [
              75.913498012000048,
              14.467174011000054
			],
            [
              75.91322901400008,
              14.467565982000053
            ],
            [
              75.913552005000042,
              14.46750597700003
			],
            [
              75.915293992000045,
              14.467626022000047
            ],
            [
              75.915210019000085,
              14.467129035000028
			],
            [
              75.915293992000045,
              14.467626022000047
            ],
            [
              75.914642977000085,
              14.467787003000069
			],
            [
              75.915232028000048,
              14.46770200800006
            ],
            [
              75.915819997000085,
              14.467576974000053
            ],
            [
              75.916487000000075,
              14.467416018000051
			],
            [
              75.914642977000085,
              14.467787003000069
            ],
            [
              75.914623990000052,
              14.467521969000074
            ],
            [
              75.914597008000044,
              14.466930034000029
			],
            [
              75.914642977000085,
              14.467787003000069
            ],
            [
              75.914646975000039,
              14.46784800000006
			],
            [
              75.914642977000085,
              14.467787003000069
            ],
            [
              75.914122009000039,
              14.467907978000028
			],
            [
              75.920211020000067,
              14.467816005000032
            ],
            [
              75.920813974000055,
              14.467745042000047
            ],
            [
              75.921156974000041,
              14.467676994000044
			],
            [
              75.920211020000067,
              14.467816005000032
            ],
            [
              75.920265004000044,
              14.468106029000069
			],
            [
              75.914646975000039,
              14.46784800000006
            ],
            [
              75.915232028000048,
              14.46770200800006
			],
            [
              75.914646975000039,
              14.46784800000006
            ],
            [
              75.914721013000076,
              14.468870993000053
			],
            [
              75.914122009000039,
              14.467907978000028
            ],
            [
              75.913872032000029,
              14.467956041000036
			],
            [
              75.913872032000029,
              14.467956041000036
            ],
            [
              75.91379898200006,
              14.467341958000077
			],
            [
              75.913872032000029,
              14.467956041000036
            ],
            [
              75.913613965000081,
              14.468009016000053
			],
            [
              75.913613965000081,
              14.468009016000053
            ],
            [
              75.913592031000064,
              14.46765902900006
            ],
            [
              75.913552005000042,
              14.46750597700003
			],
            [
              75.913613965000081,
              14.468009016000053
            ],
            [
              75.913075995000042,
              14.468107006000025
			],
            [
              75.913075995000042,
              14.468107006000025
            ],
            [
              75.913094007000041,
              14.467591001000073
            ],
            [
              75.91322901400008,
              14.467565982000053
			],
            [
              75.913075995000042,
              14.468107006000025
            ],
            [
              75.912288969000031,
              14.468273027000066
            ],
            [
              75.911916030000043,
              14.466930042000058
            ],
            [
              75.911842037000042,
              14.466626987000041
            ],
            [
              75.911754006000081,
              14.466295966000075
            ],
            [
              75.911668034000058,
              14.465982020000069
            ],
            [
              75.911587011000051,
              14.465680980000059
            ],
            [
              75.911518031000071,
              14.465424997000071
            ],
            [
              75.911447992000035,
              14.465172002000031
            ],
            [
              75.911372991000064,
              14.464903026000059
            ],
            [
              75.911304974000075,
              14.464657977000059
            ],
            [
              75.91123198300005,
              14.464393965000056
			],
            [
              75.911342962000049,
              14.468513961000042
            ],
            [
              75.912290971000061,
              14.468351024000071
            ],
            [
              75.913105035000058,
              14.468173961000048
            ],
            [
              75.914130023000041,
              14.467977998000038
            ],
            [
              75.914646975000039,
              14.46784800000006
			],
            [
              75.916728007000074,
              14.468762039000069
            ],
            [
              75.916756970000051,
              14.468922003000046
			],
            [
              75.915427994000083,
              14.468831004000037
            ],
            [
              75.915232028000048,
              14.46770200800006
			],
            [
              75.915427994000083,
              14.468831004000037
            ],
            [
              75.916163008000069,
              14.46883600700005
            ],
            [
              75.916569012000082,
              14.468832980000059
            ],
            [
              75.916634025000064,
              14.468810040000051
            ],
            [
              75.916728007000074,
              14.468762039000069
			],
            [
              75.914721013000076,
              14.468870993000053
            ],
            [
              75.915120038000055,
              14.468845037000051
            ],
            [
              75.915427994000083,
              14.468831004000037
			],
            [
              75.914721013000076,
              14.468870993000053
            ],
            [
              75.91474502300008,
             14.469390992000058]
  
  ]],
    spatialReference: { wkid: 4326 }
  });

  // ----- Start/End points for each route (approx from your original) -----
  const start1 = new Graphic({
    geometry: new Point({ longitude: 75.902828, latitude: 14.464268, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "green", size: 10, outline: { color: [255,255,255], width: 1 } }
  });
  const end1 = new Graphic({
    geometry: new Point({ longitude: 75.902769, latitude: 14.463531, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "red", size: 10, outline: { color: [255,255,255], width: 1 } }
  });

  const start2 = new Graphic({
    geometry: new Point({ longitude: 75.909513, latitude: 14.464849, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "green", size: 10, outline: { color: [255,255,255], width: 1 } }
  });
  const end2 = new Graphic({
    geometry: new Point({ longitude: 75.909792, latitude: 14.465896, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "red", size: 10, outline: { color: [255,255,255], width: 1 } }
  });
  const start3 = new Graphic({
    geometry: new Point({ longitude: 75.905500000000004, latitude: 14.445349999999999, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "green", size: 10, outline: { color: [255,255,255], width: 1 } }
  });
  const end3 = new Graphic({
    geometry: new Point({ longitude: 75.905109999999993, latitude: 14.450799999999999, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "red", size: 10, outline: { color: [255,255,255], width: 1 } }
  });
  const start4 = new Graphic({
    geometry: new Point({ longitude: 75.9071, latitude: 14.456200000000001, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "green", size: 10, outline: { color: [255,255,255], width: 1 } }
  });
  const end4 = new Graphic({
    geometry: new Point({ longitude: 75.904790000000006, latitude: 14.450900000000001, spatialReference: { wkid: 4326 } }),
    symbol: { type: "simple-marker", color: "red", size: 10, outline: { color: [255,255,255], width: 1 } }
  });

  // Visual styling
  const fillSymbol = { type: "simple-fill", color: [227,139,79,0.12], outline: { color: [227,139,79,0.7], width: 1 } };
  const routeSymbol = { type: "simple-line", color: [40,98,228], width: 3 };
  const bufferSymbol = { type: "simple-fill", color: [40,98,228,0.06], outline: { color: [40,98,228,0.4], width: 1 } };

  // Graphics for Ward22-A (polygon + route1)
  const wardA_fill = new Graphic({ geometry: wardPolygon, symbol: fillSymbol });
  const wardA_route = new Graphic({ geometry: route1, symbol: routeSymbol });
  const wardA_buffer = new Graphic({
    geometry: geometryEngine.union([ geometryEngine.geodesicBuffer(route1, ROUTE_BUFFER_METERS, "meters") ]),
    symbol: bufferSymbol
  });
  const wardA_start = start1, wardA_end = end1;

  // Graphics for Ward22-B (use same polygon + route2)
  const wardB_fill = new Graphic({ geometry: wardPolygon, symbol: fillSymbol });
  const wardB_route = new Graphic({ geometry: route2, symbol: routeSymbol });
  const wardB_buffer = new Graphic({
    geometry: geometryEngine.union([ geometryEngine.geodesicBuffer(route2, ROUTE_BUFFER_METERS, "meters") ]),
    symbol: bufferSymbol
  });
  const wardB_start = start2, wardB_end = end2;
  
  const wardC_fill = new Graphic({ geometry: wardPolygon1, symbol: fillSymbol });
  const wardC_route = new Graphic({ geometry: route1A, symbol: routeSymbol });
  const wardC_buffer = new Graphic({
    geometry: geometryEngine.union([ geometryEngine.geodesicBuffer(route1A, ROUTE_BUFFER_METERS, "meters") ]),
    symbol: bufferSymbol
  });
  const wardC_start = start3, wardC_end = end3;
  
  const wardD_fill = new Graphic({ geometry: wardPolygon1, symbol: fillSymbol });
  const wardD_route = new Graphic({ geometry: route2B, symbol: routeSymbol });
  const wardD_buffer = new Graphic({
    geometry: geometryEngine.union([ geometryEngine.geodesicBuffer(route2B, ROUTE_BUFFER_METERS, "meters") ]),
    symbol: bufferSymbol
  });
  const wardD_start = start4, wardD_end = end4;

  // Placeholders for Ward3 and Ward4 (empty for now)
  const ward3_fill = null;
  const ward4_fill = null;

  // store by ward for easy toggling
  const wardGraphics = {
    "Ward22-A": [wardA_fill, wardA_route, wardA_buffer, wardA_start, wardA_end],
    "Ward22-B": [wardB_fill, wardB_route, wardB_buffer, wardB_start, wardB_end],
	"Ward42-A": [wardC_fill, wardC_route, wardC_buffer, wardC_start, wardC_end],
	"Ward42-B": [wardD_fill, wardD_route, wardD_buffer, wardD_start, wardD_end],
    "Ward3": [], "Ward4": []
  };

  // Add nothing initially; we'll add on ward selection
  let vehicleGraphic = null;
  let deviationGraphic = null;
  let firstGoToDone = false;
  let isFetching = false;
  let intervalId = null;

  wardSelect.addEventListener("change", () => {
    const ward = wardSelect.value;
    // set vehicle number for selected ward
    vehicleNumberInput.value = ward ? (wardToVehicle[ward] || "") : "";
    // clear map graphics and re-add only selected ward's graphics
    view.graphics.removeAll();
    // add only the selected ward graphics
    if (ward && wardGraphics[ward]) {
      view.graphics.addMany(wardGraphics[ward].filter(Boolean));
    }
    // re-add vehicle if exists so the marker remains visible when ward selected
    if (vehicleGraphic) view.graphics.add(vehicleGraphic);
    // center/zoom to ward if available
    if (ward && wardGraphics[ward] && wardGraphics[ward].length > 0) {
      try {
        // attempt to get polygon extent (first item is fill)
        const g = wardGraphics[ward][0];
        if (g && g.geometry && g.geometry.extent) view.goTo(g.geometry.extent.expand(1.1));
      } catch(e){ console.warn("goTo failed:", e); }
    }
  });

  recenterBtn.addEventListener("click", () => {
    if (vehicleGraphic && vehicleGraphic.geometry) view.goTo({ center: vehicleGraphic.geometry, zoom: 17 });
    else view.goTo({ center: [75.9063,14.4634], zoom: 14 });
  });

  refreshNowBtn.addEventListener("click", () => { loadVehicle(); });

  function findVehicleInApi(dataArray, targetPlate) {
    if (!Array.isArray(dataArray)) return null;
    const plateKeys = ["vehicleregno","vehicleRegNo","vehicleRegNumber","VehicleRegNo","VehicleRegNumber","VehicleNo","VehicleNumber","regno","RegNo"];
    return dataArray.find(v => {
      for (const k of plateKeys) {
        if (v && v[k]) {
          if (normalizePlate(v[k]) === targetPlate) return true;
        }
      }
      return false;
    });
  }
  // --- Function to get a road-following route from OSRM ---
// 🚗 Function: Draw route from current position to a ward's START point
async function getRoadPolyline(startGraphic, endGraphic) {
  try {
    const startLng = startGraphic.geometry.longitude;
    const startLat = startGraphic.geometry.latitude;
    const endLng = endGraphic.geometry.longitude;
    const endLat = endGraphic.geometry.latitude;

    // Get the road-following path (OSRM will snap these points)
    const routeRes = await fetch(
      `https://router.project-osrm.org/route/v1/driving/${startLng},${startLat};${endLng},${endLat}?overview=full&geometries=geojson`
    );
    const routeData = await routeRes.json();
    if (!routeData.routes?.length) return null;

    // Get OSRM's road path
    let coords = routeData.routes[0].geometry.coordinates;

    // 🚨 Force the polyline to start at your real start point (NOT the snapped one)
    const distFromTrueStart = Math.sqrt(
      (coords[0][0] - startLng) ** 2 + (coords[0][1] - startLat) ** 2
    );
    if (distFromTrueStart > 0.00001) {
      coords.unshift([startLng, startLat]);
    }

    // 🚨 Force the polyline to end at your real end point
    const distFromTrueEnd = Math.sqrt(
      (coords[coords.length - 1][0] - endLng) ** 2 + (coords[coords.length - 1][1] - endLat) ** 2
    );
    if (distFromTrueEnd > 0.00001) {
      coords.push([endLng, endLat]);
    }

    // Return road-following polyline that includes your true start point
    return {
      type: "polyline",
      paths: [coords],
      spatialReference: { wkid: 4326 }
    };
  } catch (err) {
    console.error("Error generating route:", err);
    return null;
  }
}


function showDirectionToStart(route) {
  // always pick the first coordinate of the route as the start
  const firstPath = route.paths[0];
  if (!firstPath || firstPath.length < 2) return;

  const [startLon, startLat] = firstPath[0];
  const [nextLon, nextLat] = firstPath[1];

  const startPoint = new Point({
    longitude: startLon,
    latitude: startLat,
    spatialReference: { wkid: 4326 }
  });

  const directionLine = new Polyline({
    paths: [[[startLon, startLat], [nextLon, nextLat]]],
    spatialReference: { wkid: 4326 }
  });

  const startGraphic = new Graphic({
    geometry: startPoint,
    symbol: {
      type: "simple-marker",
      color: "green",
      size: 10,
      outline: { color: [255, 255, 255], width: 1 }
    }
  });

  const arrowGraphic = new Graphic({
    geometry: directionLine,
    symbol: {
      type: "simple-line",
      color: [0, 128, 255, 0.8],
      width: 3,
      marker: {
        type: "arrow",
        color: [0, 128, 255],
        style: "short"
      }
    }
  });

  view.graphics.addMany([startGraphic, arrowGraphic]);
  view.goTo(startPoint).catch(() => {});
}


  async function loadVehicle() {
    if (isFetching) { console.log("fetch already running"); return; }
    isFetching = true;
    try {
      console.log("Fetching vehicle data from:", API_URL);
      const res = await fetch(API_URL, { cache: "no-store" });
      if (!res.ok) { setStatus(`API error ${res.status}`, "warn"); isFetching = false; return; }
      const data = await res.json();
      console.log("API response:", data);

      const selectedVehicle = (vehicleNumberInput.value || "").trim();
      if (!selectedVehicle) { setStatus("No vehicle selected", "warn"); isFetching = false; return; }
      const targetNorm = normalizePlate(selectedVehicle);
      const candidate = findVehicleInApi(data, targetNorm);
      if (!candidate) { setStatus(`Vehicle ${selectedVehicle} not found`, "warn"); isFetching = false; return; }

      const fix = parseLatLon(candidate);
      if (!fix) { setStatus(`Vehicle ${selectedVehicle} has invalid coords`, "warn"); console.log("Candidate:", candidate); isFetching = false; return; }

      const { lat, lon } = fix;

      // create or update vehicleGraphic
      if (!vehicleGraphic) {
        vehicleGraphic = new Graphic({
          geometry: new Point({ longitude: lon, latitude: lat, spatialReference: { wkid: 4326 } }),
          symbol: {
            type: "picture-marker",
            url: "truck.png", // ensure exists or replace with URL
            width: "36px",
            height: "36px"
          },
          popupTemplate: { title: selectedVehicle, content: `Lat: ${lat}<br>Lon: ${lon}` }
        });
        view.graphics.add(vehicleGraphic);
      } else {
        vehicleGraphic.geometry = new Point({ longitude: lon, latitude: lat, spatialReference: { wkid: 4326 } });
      }

      if (!firstGoToDone) {
        try { view.goTo({ center: [lon, lat], zoom: 17 }); } catch(e){ console.warn(e); }
        firstGoToDone = true;
      }

      // run deviation logic for the currently selected ward
      checkDeviationAndUpdateStatus();

    } catch (err) {
      console.error("Fetch failed:", err);
      setStatus("Vehicle API fetch error", "warn");
    } finally {
      isFetching = false;
    }
  }
   function bearingBetween(p1, p2) {
    const toRad = Math.PI/180, toDeg = 180/Math.PI;
    const lat1 = p1.latitude*toRad, lat2 = p2.latitude*toRad;
    const dLon = (p2.longitude - p1.longitude)*toRad;
    const y = Math.sin(dLon)*Math.cos(lat2);
    const x = Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);
    return (Math.atan2(y,x)*toDeg+360)%360;
  }
  function directionText(diff) {
    if (diff > 45 && diff <= 135) return "Turn Right ➡️";
    if (diff > 225 && diff <= 315) return "Turn Left ⬅️";
    return "Go Straight ⬆️";
  }

let deviationArrows = [];
  let lastBearing = null;
async function checkDeviationAndUpdateStatus() {
  try {
    // Ensure vehicle graphic exists
    if (!vehicleGraphic || !vehicleGraphic.geometry) {
      console.warn("No vehicle geometry available yet.");
      setStatus("Vehicle location not available", "warn");
      return;
    }

    const ward = wardSelect.value || "Ward22-A";
    const p = vehicleGraphic.geometry;

    // Remove previous deviation graphic
    if (deviationGraphic) {
      view.graphics.remove(deviationGraphic);
      deviationGraphic = null;
    }

    // Initialize
    let bufferGeom = null, routeGeom = null, polyGeom = null;

    // Safe geometry assignment per ward
    if (ward === "Ward22-A" && wardA_buffer?.geometry && route1 && wardPolygon) {
      bufferGeom = wardA_buffer.geometry;
      routeGeom = route1;
      polyGeom = wardPolygon;
    } else if (ward === "Ward22-B" && wardB_buffer?.geometry && route2 && wardPolygon) {
      bufferGeom = wardB_buffer.geometry;
      routeGeom = route2;
      polyGeom = wardPolygon;
    } else if (ward === "Ward42-A" && wardC_buffer?.geometry && route1A && wardPolygon1) {
      bufferGeom = wardC_buffer.geometry;
      routeGeom = route1A;
      polyGeom = wardPolygon1;
    } else if (ward === "Ward42-B" && wardD_buffer?.geometry && route2B && wardPolygon1) {
      bufferGeom = wardD_buffer.geometry;
      routeGeom = route2B;
      polyGeom = wardPolygon1;
    } else {
      console.warn("No valid geometry found for this ward:", ward);
      setStatus("Geometry not found for selected ward", "warn");
      return;
    }

    // Check geometry validity
    if (!bufferGeom?.spatialReference || !polyGeom?.spatialReference) {
      console.warn("Spatial reference missing for ward:", ward);
      setStatus("Invalid geometry or spatial reference missing", "warn");
      return;
    }

    // Perform containment checks safely
    let insidePoly = false, insideBuffer = false;
    try {
      insidePoly = geometryEngine.contains(polyGeom, p);
    } catch (e) {
      console.warn("Polygon containment check failed:", e);
    }

    try {
      insideBuffer = geometryEngine.contains(bufferGeom, p);
    } catch (e) {
      console.warn("Buffer containment check failed:", e);
    }

    let statusMsg = "✅ On route within ward";
    let level = "ok";

    // If vehicle is outside route or buffer
    if (!insidePoly || !insideBuffer) {
      try {
        if (routeGeom && routeGeom.spatialReference) {
          const nearest = geometryEngine.nearestCoordinate(routeGeom, p);
          if (nearest?.coordinate) {
            const nearestPt = new Point({
              x: nearest.coordinate.x,
              y: nearest.coordinate.y,
              spatialReference: routeGeom.spatialReference
            });

          // --- Draw road-following deviation line starting from vehicle location ---
try {
  const url = `https://router.project-osrm.org/route/v1/driving/${p.longitude},${p.latitude};${nearestPt.longitude},${nearestPt.latitude}?overview=full&geometries=geojson`;

  const routeResponse = await fetch(url);
  const data = await routeResponse.json();

  if (!data.routes?.length || !data.routes[0].geometry) {
    console.warn("No valid OSRM route found between vehicle and nearest point.");
    return;
  }

  const roadPath = data.routes[0].geometry.coordinates;
  const vehicleCoord = [p.longitude, p.latitude];
  if (JSON.stringify(roadPath[0]) !== JSON.stringify(vehicleCoord)) {
    roadPath.unshift(vehicleCoord);
  }

  const deviationGraphic = new Graphic({
    geometry: new Polyline({
      paths: [roadPath],
      spatialReference: { wkid: 4326 }
    }),
    symbol: {
      type: "simple-line",
      color: [255, 0, 0],
      width: 4
    },
    attributes: { type: "deviation-line" }
  });

  // Remove old deviation lines
  view.graphics.removeMany(
    view.graphics.filter(g => g.attributes?.type === "deviation-line")
  );

  view.graphics.add(deviationGraphic);
  console.log("✅ Deviation line drawn from vehicle location along road path.");
} catch (err) {
  console.error("Error fetching or drawing OSRM route:", err);
}

            view.graphics.add(deviationGraphic);
            statusMsg = "⚠️ Vehicle off route";
            level = "alert";
          } else {
            statusMsg = "⚠️ Vehicle not near route";
            level = "warn";
          }
        } else {
          console.warn("No valid route geometry to calculate deviation.");
        }
      } catch (e) {
        console.warn("Deviation calculation failed:", e);
      }
    }

    // Update status bar
    setStatus(statusMsg, level);
  } catch (err) {
    console.error("checkDeviationAndUpdateStatus() failed:", err);
    setStatus("Unexpected error in deviation check", "alert");
  }
}


  // Boot
  view.when(() => {
    setStatus("Map ready — select a ward");
    // Optionally add Ward22-A on load
    // view.graphics.addMany(wardGraphics["Ward22-A"]);
    // Start interval only after a ward is selected and vehicle is set; but we will still start polling
    loadVehicle();
    intervalId = setInterval(loadVehicle, REFRESH_MS);
  });

  // service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => console.log("Service Worker registered:", reg.scope))
        .catch(err => console.warn("Service Worker registration failed:", err));
    });
  }
  });//required
</script>
</body>
</html>






















